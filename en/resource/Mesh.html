
<!DOCTYPE HTML>
<html lang="en" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Bluetooth Mesh(TUYA) Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-prism/prism-okaidia.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="Mesh.html" />
    
    
    <link rel="prev" href="BLE.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="Overview.html">
            
                <a href="Overview.html">
            
                    
                    Function Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="Preparation.html">
            
                <a href="Preparation.html">
            
                    
                    Preparation work
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="iOSAdaptation.html">
            
                <a href="iOSAdaptation.html">
            
                    
                    iOS Adaptation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="Integrated.html">
            
                <a href="Integrated.html">
            
                    
                    Initiate SDK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="User.html">
            
                <a href="User.html#user-management">
            
                    
                    User management
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="User.html">
            
                <a href="User.html#use-mobile-phone-for-login">
            
                    
                    Use Mobile Phone for Login
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="User.html">
            
                <a href="User.html#use-email-for-login">
            
                    
                    Use Email for Login
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="User.html">
            
                <a href="User.html#use-uid-for-login">
            
                    
                    Use uid for Login
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="User.html">
            
                <a href="User.html#third-party-login">
            
                    
                    Third Party Login
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="User.html">
            
                <a href="User.html#login-by-auth2">
            
                    
                    Login by Auth2(Login with Apple)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="User.html">
            
                <a href="User.html#modify-user-avatar">
            
                    
                    Modify User Info
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="User.html">
            
                <a href="User.html#logout">
            
                    
                    Logout, Disable Account
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8" data-path="User.html">
            
                <a href="User.html#handling-of-expired-session">
            
                    
                    Handling of Expired Session
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <span>
            
                    
                    Home management
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="Home.html">
            
                <a href="Home.html#home-management">
            
                    
                    Home Management Class
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="Home.html">
            
                <a href="Home.html#home-information-management">
            
                    
                    Operation Class of Home
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="Home.html">
            
                <a href="Home.html#home-member-management">
            
                    
                    Home Member Management Class
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="Home.html">
            
                <a href="Home.html#room-information-management">
            
                    
                    Room Management Class
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="Activator.html">
            
                <a href="Activator.html#network-configuration">
            
                    
                    Network Configuration
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="Activator.html">
            
                <a href="Activator.html#ez-mode">
            
                    
                    EZ mode
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="Activator.html">
            
                <a href="Activator.html#ap-mode">
            
                    
                    AP mode
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="Activator.html">
            
                <a href="Activator.html#wired-network-configuration-of-zigbee">
            
                    
                    Activate the ZigBee Gateway
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="Activator.html">
            
                <a href="Activator.html#activate-the-zigbee-sub-device">
            
                    
                    Activate the ZigBee sub-device
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="Device.html">
            
                <a href="Device.html#device-management">
            
                    
                    Device management
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="Device.html">
            
                <a href="Device.html#update-device-information">
            
                    
                    Update device information
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="Device.html">
            
                <a href="Device.html#device-control">
            
                    
                    Device Control
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.2.1" data-path="Device.html">
            
                <a href="Device.html#standard-device-control-beta">
            
                    
                    Standard Device Control
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.2" data-path="Device.html">
            
                <a href="Device.html#custom-device-control">
            
                    
                    Custom Device Control
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="Device.html">
            
                <a href="Device.html#modify-the-device-name">
            
                    
                    Modify the device name
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="Device.html">
            
                <a href="Device.html#remove-device">
            
                    
                    Remove device
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="Device.html">
            
                <a href="Device.html#obtain-wifi-signal-strength-of-device">
            
                    
                    Obtain Wifi signal strength of device
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6" data-path="Device.html">
            
                <a href="Device.html#obtain-the-sub-device-list-of-a-gateway">
            
                    
                    Obtain the sub-device list of a gateway
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.7" data-path="Device.html">
            
                <a href="Device.html#firmware-upgrade">
            
                    
                    Firmware upgrade
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="Share.html">
            
                <a href="Share.html#shared-devices">
            
                    
                    Share devices
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="Share.html">
            
                <a href="Share.html#add-device-share">
            
                    
                    Add device share
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="Share.html">
            
                <a href="Share.html#getting-shared-relationships">
            
                    
                    Getting Shared Relationships
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="Share.html">
            
                <a href="Share.html#remove-sharing">
            
                    
                    Remove Sharing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4" data-path="Share.html">
            
                <a href="Share.html#modify-note-name">
            
                    
                    Modify Note Name
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="Timer.html">
            
                <a href="Timer.html">
            
                    
                    Timer task
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="Group.html">
            
                <a href="Group.html">
            
                    
                    Group management
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" >
            
                <span>
            
                    
                    Smart scene
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.13.1" data-path="SmartScene.html">
            
                <a href="SmartScene.html#smart-scene">
            
                    
                    Smart scene
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.2" data-path="SmartScene.html">
            
                <a href="SmartScene.html#scene-operation">
            
                    
                    Scene operation
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="DataChannel.html">
            
                <a href="DataChannel.html">
            
                    
                    Data channel
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="BLE.html">
            
                <a href="BLE.html#single-ble">
            
                    
                    Single BLE
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.1" data-path="BLE.html">
            
                <a href="BLE.html#bluetooth-status-monitor">
            
                    
                    Bluetooth Status Monitor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.2" data-path="BLE.html">
            
                <a href="BLE.html#ble-device-scan">
            
                    
                    Bluetooth Scan
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.3" data-path="BLE.html">
            
                <a href="BLE.html#active-device">
            
                    
                    Active device
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.4" data-path="BLE.html">
            
                <a href="BLE.html#ble-device-ota-upgrade">
            
                    
                    Firmware Upgrade
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.5" data-path="BLE.html">
            
                <a href="BLE.html#device-dp-publish">
            
                    
                    Device DP publish
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="Mesh.html">
            
                <a href="Mesh.html#bluetooth-meshtuya-sdk-guide">
            
                    
                    Bluetooth Mesh(TUYA)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.1" data-path="Mesh.html">
            
                <a href="Mesh.html#basic-notion">
            
                    
                    Basic Notion
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2" data-path="Mesh.html">
            
                <a href="Mesh.html#management">
            
                    
                    Management
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.3" data-path="Mesh.html">
            
                <a href="Mesh.html#configuration">
            
                    
                    Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4" data-path="Mesh.html">
            
                <a href="Mesh.html#mesh-device">
            
                    
                    Device
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.5" data-path="Mesh.html">
            
                <a href="Mesh.html#mesh-group">
            
                    
                    Group
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.6" data-path="Mesh.html">
            
                <a href="Mesh.html#mesh-control">
            
                    
                    Control
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.7" data-path="Mesh.html">
            
                <a href="Mesh.html#firmware-upgrade">
            
                    
                    Firmware Upgrade
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.17" data-path="SIGMesh.html">
            
                <a href="SIGMesh.html#bluetooth-mesh-sdk-guide">
            
                    
                    Bluetooth Mesh(SIG)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.17.1" data-path="SIGMesh.html">
            
                <a href="SIGMesh.html#introduction">
            
                    
                    Basic Notion
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2" data-path="SIGMesh.html">
            
                <a href="SIGMesh.html#management">
            
                    
                    Management
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.3" data-path="SIGMesh.html">
            
                <a href="SIGMesh.html#configuration">
            
                    
                    Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.4" data-path="SIGMesh.html">
            
                <a href="SIGMesh.html#mesh-device">
            
                    
                    Device
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.5" data-path="SIGMesh.html">
            
                <a href="SIGMesh.html#mesh-group">
            
                    
                    Group
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.6" data-path="SIGMesh.html">
            
                <a href="SIGMesh.html#mesh-control">
            
                    
                    Control
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.7" data-path="SIGMesh.html">
            
                <a href="SIGMesh.html#firmware-upgrade">
            
                    
                    Firmware Upgrade
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.18" >
            
                <span>
            
                    
                    Message center
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.18.1" data-path="Message.html">
            
                <a href="Message.html#obtain-message-list">
            
                    
                    Message list
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.2" data-path="Message.html">
            
                <a href="Message.html#message-push-settings">
            
                    
                    Message push settings
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.19" data-path="Feedback.html">
            
                <a href="Feedback.html">
            
                    
                    Feedback
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20" data-path="CommonInterface.html">
            
                <a href="CommonInterface.html">
            
                    
                    Common interface
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.21" data-path="Push.html">
            
                <a href="Push.html">
            
                    
                    Register pushId
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.22" >
            
                <a target="_blank" href="https://tuyainc.github.io/tuyasmart_home_ios_sdk_api_reference/index.html">
            
                    
                    API Reference
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.23" data-path="Faq.html">
            
                <a href="Faq.html">
            
                    
                    FAQ
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.24" data-path="ChangeLog.html">
            
                <a href="ChangeLog.html">
            
                    
                    ChangeLog
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Bluetooth Mesh(TUYA)</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="bluetooth-meshtuya-sdk-guide"><a name="bluetooth-meshtuya-sdk-guide" class="plugin-anchor" href="#bluetooth-meshtuya-sdk-guide"><i class="fa fa-link" aria-hidden="true"></i></a>Bluetooth Mesh(TUYA) SDK Guide</h2>
<h3 id="introduction"><a name="introduction" class="plugin-anchor" href="#introduction"><i class="fa fa-link" aria-hidden="true"></i></a>Introduction</h3>
<p>Generally speaking, Bluetooth mesh is to form a mesh network with multiple Bluetooth single-point devices. Each node can communicate with other nodes freely. By directly connecting to any device in the mesh network via mobile phone <strong>, you can access and control the mesh network All equipment </strong></p>
<h3 id="tips"><a name="tips" class="plugin-anchor" href="#tips"><i class="fa fa-link" aria-hidden="true"></i></a>Tips</h3>
<pre class="language-"><code class="lang-objective-c">  <span class="token comment">// import header file</span>
  <span class="token macro property">#<span class="token directive keyword">import</span> &lt;TuyaSmartBLEMeshKit/TuyaSmartBLEMeshKit.h&gt;</span>
</code></pre>
<pre class="language-"><code class="lang-objective-c">  <span class="token comment">// set sdk open mesh, need to be set during initialization</span>
  <span class="token punctuation">[</span><span class="token punctuation">[</span>TuyaSmartSDK sharedInstance<span class="token punctuation">]</span> setValue<span class="token punctuation">:</span><span class="token operator">@</span><span class="token punctuation">(</span>YES<span class="token punctuation">)</span> forKey<span class="token punctuation">:</span><span class="token string">@&quot;bleMeshEnable&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="basic-notion"><a name="basic-notion" class="plugin-anchor" href="#basic-notion"><i class="fa fa-link" aria-hidden="true"></i></a>Basic Notion</h3>
<ul>
<li><p>pcc</p>
<p>Each mesh device corresponds to a product, and each product has its own size class label. The SDK uses pcc andtype as the size class label.</p>
<p>Mesh product type</p>
<pre class="language-"><code class="lang-objective-c">  <span class="token function">light</span><span class="token punctuation">(</span><span class="token number">01</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token operator">-</span><span class="token number">5</span>  RGBWC 
  <span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token number">02</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token operator">-</span><span class="token number">6</span> 
  <span class="token function">sensor</span><span class="token punctuation">(</span><span class="token number">04</span><span class="token punctuation">)</span><span class="token punctuation">:</span> 
  <span class="token function">Actuator</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Alarm
  <span class="token function">adapter</span><span class="token punctuation">(</span><span class="token number">08</span><span class="token punctuation">)</span><span class="token punctuation">:</span> gateway&#xFF08;
</code></pre>
<p>sub product type</p>
<pre class="language-"><code class="lang-objective-c">  <span class="token number">1</span><span class="token operator">-</span><span class="token number">5</span> light&#xFF08;<span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>&#xFF09;
  <span class="token number">1</span><span class="token operator">-</span><span class="token number">6</span> swicth&#xFF08;<span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre>
<p>pcc example</p>
<pre class="language-"><code class="lang-objective-c">   rgb light   <span class="token number">0301</span>
   rgbwc light <span class="token number">0501</span>
   <span class="token number">5</span> <span class="token keyword">switch</span>    <span class="token number">0502</span>
   gateway     <span class="token number">0108</span>
   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre>
</li>
<li><p>mesh node Id</p>
<p>The node id is used to distinguish the &quot;unique identifier&quot; of each mesh device in the mesh network. For example, if you want to control a device, you can send the nodeId command corresponding to this device to the mesh network</p>
</li>
<li><p>mesh group local Id</p>
<p>The local Id is used to distinguish the `` unique identifier &apos;&apos; of each mesh group in the mesh network.For example, if you want to control the devices in a group, you can send the localId command corresponding to this group to the mesh network.</p>
</li>
<li><p>Equipment operation requires multiple steps</p>
<p>Because device operations, such as adding and deleting operations, and group operations, require the local Bluetooth command to be executed once and recorded in the cloud once. The operation information needs to be synchronized to the local mesh network as well.</p>
</li>
<li><p>Local Connection and Gateway Connection
Local Connection: The networked device is connected via Bluetooth to control mesh and command operations
GatewayConnection: The networked devices are connected through the gateway (the gateway needs to be with the device, and the distance cannot be too far) to control the mesh and command operations.</p>
</li>
</ul>
<h3 id="management"><a name="management" class="plugin-anchor" href="#management"><i class="fa fa-link" aria-hidden="true"></i></a>Management</h3>
<blockquote>
<p><code>TuyaSmartBleMesh.h</code></p>
</blockquote>
<h4 id="create-mesh"><a name="create-mesh" class="plugin-anchor" href="#create-mesh"><i class="fa fa-link" aria-hidden="true"></i></a>Create mesh</h4>
<p>A family can have multiple sig meshes (it is recommended to create only one family). All operations in the sig mesh are based on the family data being initialized.</p>
<blockquote>
<p>Init home <a href="https://tuyainc.github.io/tuyasmart_home_ios_sdk_doc/en/resource/Home.html#home-management" target="_blank">See</a></p>
</blockquote>
<pre class="language-"><code class="lang-objective-c"><span class="token comment">/**
 create mesh


 @param meshName mesh name
 @param homeId  homeId
 @param success
 @param failure 
 */</span>
<span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>createBleMeshWithMeshName<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>meshName
                           homeId<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">long</span><span class="token punctuation">)</span>homeId
                          success<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">(</span><span class="token operator">^</span><span class="token punctuation">)</span><span class="token punctuation">(</span>TuyaSmartBleMeshModel <span class="token operator">*</span>meshModel<span class="token punctuation">)</span><span class="token punctuation">)</span>success
                          failure<span class="token punctuation">:</span><span class="token punctuation">(</span>TYFailureError<span class="token punctuation">)</span>failure<span class="token punctuation">;</span>
</code></pre>
<p>&#x300C;Example&#x300D;</p>
<pre class="language-"><code class="lang-objective-c">TuyaSmartHome <span class="token operator">*</span>home <span class="token operator">=</span> #<span class="token operator">&lt;</span> home instance<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> <span class="token keyword">long</span> homeId <span class="token operator">=</span> home<span class="token punctuation">.</span>homeModel<span class="token punctuation">.</span>homeId<span class="token punctuation">;</span>
<span class="token punctuation">[</span>TuyaSmartBleMesh createBleMeshWithMeshName<span class="token punctuation">:</span><span class="token string">@&quot;yourMeshName&quot;</span> homeId<span class="token punctuation">:</span>homeId success<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>TuyaSmartBleMeshModel <span class="token operator">*</span>meshModel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// success do...</span>
<span class="token punctuation">}</span> failure<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>NSError <span class="token operator">*</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;create mesh error: %@&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre>
<blockquote>
<p>The meshName of this method is custom, and it is recommended to set it with unique parameters, such as &quot;mesh + timestamp form&quot;</p>
</blockquote>
<h4 id="delete-mesh"><a name="delete-mesh" class="plugin-anchor" href="#delete-mesh"><i class="fa fa-link" aria-hidden="true"></i></a>Delete mesh</h4>
<pre class="language-"><code>/**
 Delete the mesh. If there are devices in the mesh group, the child devices are also removed. The wifi connector was also removed.

 @param success 
 @param failure 
 */
- (void)removeMeshWithSuccess:(TYSuccessHandler)success failure:(TYFailureError)failure;
</code></pre><p>&#x300C;Example&#x300D;</p>
<pre class="language-"><code class="lang-objective-c"><span class="token keyword">self</span><span class="token punctuation">.</span>mesh <span class="token operator">=</span> #<span class="token operator">&lt;</span>TuyaSmartBleMesh instance<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>mesh removeMeshWithSuccess<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">{</span>
    <span class="token comment">// success do...</span>
<span class="token punctuation">}</span> failure<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>NSError <span class="token operator">*</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">XCTFail</span><span class="token punctuation">(</span><span class="token string">@&quot;test remove mesh failure: %@&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre>
<h4 id="get-the-list-of-meshes-under-the-family"><a name="get-the-list-of-meshes-under-the-family" class="plugin-anchor" href="#get-the-list-of-meshes-under-the-family"><i class="fa fa-link" aria-hidden="true"></i></a>Get the list of meshes under the family</h4>
<p>After initializing the home instance, you can get the mesh list of the corresponding family</p>
<pre class="language-"><code class="lang-objective-c"><span class="token comment">/**
 *  Get the list of meshes under the family
 *
 *  @param success     
 *  @param failure   
 */</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>getMeshListWithSuccess<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">(</span><span class="token operator">^</span><span class="token punctuation">)</span><span class="token punctuation">(</span>NSArray <span class="token operator">&lt;</span>TuyaSmartBleMeshModel <span class="token operator">*</span><span class="token operator">&gt;</span> <span class="token operator">*</span>list<span class="token punctuation">)</span><span class="token punctuation">)</span>success
                       failure<span class="token punctuation">:</span><span class="token punctuation">(</span>TYFailureError<span class="token punctuation">)</span>failure<span class="token punctuation">;</span>
</code></pre>
<p>&#x300C;Example&#x300D;</p>
<pre class="language-"><code class="lang-objective-c">TuyaSmartHome <span class="token operator">*</span>home <span class="token operator">=</span> #<span class="token operator">&lt;</span>home instance<span class="token operator">&gt;</span>
<span class="token punctuation">[</span>home getMeshListWithSuccess<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>NSArray<span class="token operator">&lt;</span>TuyaSmartBleMeshModel <span class="token operator">*</span><span class="token operator">&gt;</span> <span class="token operator">*</span>list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// success do</span>
<span class="token punctuation">}</span> failure<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>NSError <span class="token operator">*</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;get mesh list error: %@&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre>
<h4 id="get-mesh-instance"><a name="get-mesh-instance" class="plugin-anchor" href="#get-mesh-instance"><i class="fa fa-link" aria-hidden="true"></i></a>Get Mesh Instance</h4>
<pre class="language-"><code class="lang-objective-c"><span class="token comment">/**
 Get Mesh Instance

 @param meshId mesh id
 @param homeId home id
 */</span>
<span class="token operator">+</span> <span class="token punctuation">(</span>instancetype<span class="token punctuation">)</span>bleMeshWithMeshId<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>meshId homeId<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">long</span><span class="token punctuation">)</span>homeId<span class="token punctuation">;</span>
</code></pre>
<p>&#x300C;Example&#x300D;</p>
<p>Through the family (TuyaSmartHome instance), home can get the meshModel under the class, which can be created through this, and after the creation is completed, it is assigned to the current TuyaSmartUser, and the SDK and upper layers take the value of TuyaSmartUser as the judgment criterion:</p>
<pre class="language-"><code class="lang-objective-c">
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>TuyaSmartUser sharedInstance<span class="token punctuation">]</span><span class="token punctuation">.</span>meshModel <span class="token operator">==</span> nil<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    TuyaSmartHome <span class="token operator">*</span>home <span class="token operator">=</span> #<span class="token operator">&lt;</span>home instance<span class="token operator">&gt;</span>
    <span class="token punctuation">[</span>home getMeshListWithSuccess<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>NSArray<span class="token operator">&lt;</span>TuyaSmartBleMeshModel <span class="token operator">*</span><span class="token operator">&gt;</span> <span class="token operator">*</span>list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>list<span class="token punctuation">.</span>count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token punctuation">[</span>TuyaSmartUser sharedInstance<span class="token punctuation">]</span><span class="token punctuation">.</span>meshModel <span class="token operator">=</span> home<span class="token punctuation">.</span>meshModel<span class="token punctuation">;</span>
                <span class="token punctuation">[</span>TuyaSmartUser sharedInstance<span class="token punctuation">]</span><span class="token punctuation">.</span>mesh <span class="token operator">=</span> <span class="token punctuation">[</span>TuyaSmartBleMesh bleMeshWithMeshId<span class="token punctuation">:</span>home<span class="token punctuation">.</span>meshModel<span class="token punctuation">.</span>meshId homeId<span class="token punctuation">:</span>home<span class="token punctuation">.</span>meshModel<span class="token punctuation">.</span>homeId<span class="token punctuation">]</span><span class="token punctuation">;</span>


            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>

                NSTimeInterval interval <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>NSDate date<span class="token punctuation">]</span> timeIntervalSince1970<span class="token punctuation">]</span><span class="token punctuation">;</span>
                NSString <span class="token operator">*</span>meshName <span class="token operator">=</span> <span class="token punctuation">[</span>NSString stringWithFormat<span class="token punctuation">:</span><span class="token string">@&quot;tymesh%.0f&quot;</span><span class="token punctuation">,</span> interval<span class="token punctuation">]</span><span class="token punctuation">;</span>

                <span class="token punctuation">[</span>TuyaSmartBleMesh createBleMeshWithMeshName<span class="token punctuation">:</span>meshName homeId<span class="token punctuation">:</span>home<span class="token punctuation">.</span>homeModel<span class="token punctuation">.</span>homeId success<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>TuyaSmartBleMeshModel <span class="token operator">*</span>meshModel<span class="token punctuation">)</span> <span class="token punctuation">{</span>

                    <span class="token punctuation">[</span>TuyaSmartUser sharedInstance<span class="token punctuation">]</span><span class="token punctuation">.</span>meshModel <span class="token operator">=</span> meshModel<span class="token punctuation">;</span>
                    <span class="token punctuation">[</span>TuyaSmartUser sharedInstance<span class="token punctuation">]</span><span class="token punctuation">.</span>mesh <span class="token operator">=</span> <span class="token punctuation">[</span>TuyaSmartBleMesh bleMeshWithMeshId<span class="token punctuation">:</span>meshModel<span class="token punctuation">.</span>meshId homeId<span class="token punctuation">:</span>home<span class="token punctuation">.</span>homeModel<span class="token punctuation">.</span>homeId<span class="token punctuation">]</span><span class="token punctuation">;</span>


                <span class="token punctuation">}</span> failure<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>NSError <span class="token operator">*</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> failure<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>NSError <span class="token operator">*</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre>
<h3 id="configuration"><a name="configuration" class="plugin-anchor" href="#configuration"><i class="fa fa-link" aria-hidden="true"></i></a>Configuration</h3>
<blockquote>
<p> <code>TYBLEMeshManager</code> </p>
</blockquote>
<p>The distribution network refers to adding devices that are in the reset state and not connected to the sig mesh network.</p>
<p>The following is a list of common device reset methods</p>
<h4 id="device-reset"><a name="device-reset" class="plugin-anchor" href="#device-reset"><i class="fa fa-link" aria-hidden="true"></i></a>Device Reset</h4>
<table>
<thead>
<tr>
<th>Product</th>
<th>reset</th>
<th>show</th>
</tr>
</thead>
<tbody>
<tr>
<td>Light</td>
<td>Three consecutive switches</td>
<td>flashes quickly</td>
</tr>
<tr>
<td>Switch</td>
<td>Long press 3s</td>
<td>flashes quickly</td>
</tr>
<tr>
<td>Gateway</td>
<td>Long press 3s</td>
<td>flashes quickly</td>
</tr>
</tbody>
</table>
<p>The device in the reset state, the default name is <code>out_of_mesh</code>, and the default password is <code>123456</code></p>
<h4 id="bluetooth-scan"><a name="bluetooth-scan" class="plugin-anchor" href="#bluetooth-scan"><i class="fa fa-link" aria-hidden="true"></i></a>Bluetooth Scan</h4>
<blockquote>
<p>In order to simplify scanning and subsequent distribution operations, all operations are unified into one interface.</p>
</blockquote>
<pre class="language-"><code class="lang-objective-c"><span class="token comment">/**
 mesh start

 If the operation is distribution network, fill in the default mesh name and password. At this time, it will only pass the `TYBLEMeshManagerDelegate`
 `- (void)bleMeshManager:(TYBLEMeshManager *)manager didScanedDevice:(TYBleMeshDeviceModel *)device;` 

 If the operation is to enter the network, fill in the created mesh name and password. This information is returned from the cloud interface. It can automatically connect, enter the network, and automatically obtain the online status of each device in the mesh network.

 @param name mesh 
 @param pwd mesh 
 @param active is active
 @param wifiAddress Wi-Fi address, required for gateway network configuration, the rest is 0
 @param otaAddress ota device address, required for ota upgrade, the rest is 0
 */</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>startScanWithName<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>name
                      pwd<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>pwd
                   active<span class="token punctuation">:</span><span class="token punctuation">(</span>BOOL<span class="token punctuation">)</span>active
              wifiAddress<span class="token punctuation">:</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>wifiAddress
               otaAddress<span class="token punctuation">:</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>otaAddress<span class="token punctuation">;</span>
</code></pre>
<p>If the name passed in is the default value out_of_mesh, and it is an activation operation, it will scan the surrounding devices to be configured, and the result of the scan will be called back by the method in TYBLEMeshManagerDelegate</p>
<pre class="language-"><code class="lang-objective-c"><span class="token comment">/**
 Scanning to devices to be configured


 @param manager mesh manager
 @param device un active devices
 */</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>bleMeshManager<span class="token punctuation">:</span><span class="token punctuation">(</span>TYBLEMeshManager <span class="token operator">*</span><span class="token punctuation">)</span>manager didScanedDevice<span class="token punctuation">:</span><span class="token punctuation">(</span>TYBleMeshDeviceModel <span class="token operator">*</span><span class="token punctuation">)</span>device<span class="token punctuation">;</span>
</code></pre>
<p>If it is a network access operation, subsequent operations will be performed automatically without callback.</p>
<p>&#x300C;Example&#x300D;</p>
<pre class="language-"><code class="lang-objective-c"><span class="token comment">// start scan</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span>TYBLEMeshManager sharedInstance<span class="token punctuation">]</span> startScanWithName<span class="token punctuation">:</span><span class="token string">@&quot;out_of_mesh&quot;</span> pwd<span class="token punctuation">:</span><span class="token string">@&quot;123456&quot;</span> active<span class="token punctuation">:</span>YES wifiAddress<span class="token punctuation">:</span><span class="token number">0</span> otaAddress<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// TYBLEMeshManagerDelegate </span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>bleMeshManager<span class="token punctuation">:</span><span class="token punctuation">(</span>TYBLEMeshManager <span class="token operator">*</span><span class="token punctuation">)</span>manager didScanedDevice<span class="token punctuation">:</span><span class="token punctuation">(</span>TYBleMeshDeviceModel <span class="token operator">*</span><span class="token punctuation">)</span>device <span class="token punctuation">{</span>

    <span class="token comment">// The scanned gateway devices and sub-devices will be called back by this method</span>
    <span class="token comment">// Use device.type and device.vendorInfo to determine if it is a mesh gateway</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>device<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token punctuation">[</span>TPUtils getIntValueByHex<span class="token punctuation">:</span><span class="token string">@&quot;0x0108&quot;</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>TPUtils getIntValueByHex<span class="token punctuation">:</span><span class="token punctuation">[</span>device<span class="token punctuation">.</span>vendorInfo substringWithRange<span class="token punctuation">:</span><span class="token function">NSMakeRange</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0x08</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0x08</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// mesh gateway</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// mesh sub node device </span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// getIntValueByHex</span>
<span class="token operator">+</span> <span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>getIntValueByHex<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>getStr
<span class="token punctuation">{</span>
    NSScanner <span class="token operator">*</span>tempScaner<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">[</span>NSScanner alloc<span class="token punctuation">]</span> initWithString<span class="token punctuation">:</span>getStr<span class="token punctuation">]</span><span class="token punctuation">;</span>
    uint32_t tempValue<span class="token punctuation">;</span>
    <span class="token punctuation">[</span>tempScaner scanHexInt<span class="token punctuation">:</span><span class="token operator">&amp;</span>tempValue<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> tempValue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="active"><a name="active" class="plugin-anchor" href="#active"><i class="fa fa-link" aria-hidden="true"></i></a>Active</h4>
<p>Mesh distribution networks are mainly divided into two types. One is for ordinary Bluetooth mesh devices (also called mesh sub-devices), such as lights, sockets, and low power consumption. It can be understood that as long as there is no gateway, it is an ordinary Bluetooth device. Networking for mesh gateways</p>
<pre class="language-"><code class="lang-objective-c"><span class="token comment">/**
 active device

 @param includeGateway Whether to activate the gateway. If it is `yes&apos;, the gateway device that has been recorded in the device will be activated, and the remaining sub-devices will not be activated
                         Conversely activate all scanned ordinary mesh sub-devices, do not activate the gateway
 */</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>activeMeshDeviceIncludeGateway<span class="token punctuation">:</span><span class="token punctuation">(</span>BOOL<span class="token punctuation">)</span>includeGateway<span class="token punctuation">;</span>

<span class="token comment">/**
 Activate specific devices

 @param deviceModel model
 */</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>activeMeshDevice<span class="token punctuation">:</span><span class="token punctuation">(</span>TYBleMeshDeviceModel <span class="token operator">*</span><span class="token punctuation">)</span>deviceModel<span class="token punctuation">;</span>
</code></pre>
<p> The distribution result will be called back through <code>TYBLEMeshManagerDelegate</code></p>
<pre class="language-"><code class="lang-objective-c"><span class="token comment">/**
 Activate sub device callback

 @param name device name
 @param deviceId dev Id
 @param error error 
 */</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>activeDeviceSuccessWithName<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>name deviceId<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>deviceId error<span class="token punctuation">:</span><span class="token punctuation">(</span>NSError <span class="token operator">*</span><span class="token punctuation">)</span>error<span class="token punctuation">;</span>

<span class="token comment">/**
 Activate gateway device callback

 @param name device name
 @param address device address
 @param mac gateway mac
 @param error errors
 */</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>activeWifiDeviceWithName<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>name address<span class="token punctuation">:</span><span class="token punctuation">(</span>NSInteger<span class="token punctuation">)</span>address mac<span class="token punctuation">:</span><span class="token punctuation">(</span>NSInteger<span class="token punctuation">)</span>mac error<span class="token punctuation">:</span><span class="token punctuation">(</span>NSError <span class="token operator">*</span><span class="token punctuation">)</span>error<span class="token punctuation">;</span>
</code></pre>
<p>If the gateway device is activated, you need to configure the network with the Wi-Fi module after receiving the callback <code>activeWifiDeviceWithName</code> method. At this time, you need to call the method in <code>TuyaSmartActivator</code> to perform the operation.</p>
<pre class="language-"><code class="lang-objective-c"><span class="token number">1.</span> get token
<span class="token comment">/**
 *
 *  mesh wifi gateway join mesh
 *  get Token&#xFF08;10 minutes)
 *
 *  @param meshId
 *  @param nodeId
 *  @param productId
 *  @param uuid
 *  @param authKey
 *  @param success 
 *  @param failure 
 */</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>getTokenWithMeshId<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>meshId
                    nodeId<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>nodeId
                 productId<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>productId
                      uuid<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>uuid
                   authKey<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>authKey
                   version<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>version
                   success<span class="token punctuation">:</span><span class="token punctuation">(</span>TYSuccessString<span class="token punctuation">)</span>success
                   failure<span class="token punctuation">:</span><span class="token punctuation">(</span>TYFailureError<span class="token punctuation">)</span>failure<span class="token punctuation">;</span>


<span class="token number">2.</span> Gateway<span class="token punctuation">,</span> router account<span class="token punctuation">,</span> and password <span class="token keyword">for</span> gateway access
<span class="token comment">/**
 * 
 * mesh 
 * After activating the gateway, you can call this method after receiving the `activeWifiDeviceWithName` of `TYBLEMeshManagerDelegate`
 *
 *  @param ssid     wifi ssid 
 *  @param password wifi password
 *  @param token    Token
 *  @param timeout  default 100s
 */</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>startBleMeshConfigWiFiWithSsid<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>ssid
                              password<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>password
                                 token<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>token
                               timeout<span class="token punctuation">:</span><span class="token punctuation">(</span>NSTimeInterval<span class="token punctuation">)</span>timeout<span class="token punctuation">;</span>
</code></pre>
<p>&#x300C;Example&#x300D;</p>
<ul>
<li><p>Mesh sub-devices (devices without gateways) are connected to the network</p>
<pre class="language-"><code class="lang-objective-c"><span class="token comment">// 1. Activate sub device</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span>TYBLEMeshManager sharedInstance<span class="token punctuation">]</span> activeMeshDeviceIncludeGateway<span class="token punctuation">:</span>NO<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 2. TYBLEMeshManagerDelegate </span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>activeDeviceSuccessWithName<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>name deviceId<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>deviceId error<span class="token punctuation">:</span><span class="token punctuation">(</span>NSError <span class="token operator">*</span><span class="token punctuation">)</span>error <span class="token punctuation">{</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;error : %@&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 3. Activation was successful. At this point, the activation of a sub device is complete.</span>
<span class="token punctuation">}</span>
</code></pre>
</li>
<li><p>Active gateway</p>
<pre class="language-"><code class="lang-objective-c"><span class="token comment">// 1. Activate sub device</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span>TYBLEMeshManager sharedInstance<span class="token punctuation">]</span> activeMeshDeviceIncludeGateway<span class="token punctuation">:</span>NO<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 2. TYBLEMeshManagerDelegate </span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>activeWifiDeviceWithName<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>name address<span class="token punctuation">:</span><span class="token punctuation">(</span>NSInteger<span class="token punctuation">)</span>address mac<span class="token punctuation">:</span><span class="token punctuation">(</span>NSInteger<span class="token punctuation">)</span>mac error<span class="token punctuation">:</span><span class="token punctuation">(</span>NSError <span class="token operator">*</span><span class="token punctuation">)</span>error <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;error : %@&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// The gateway was successfully activated. Currently, only the Bluetooth module is successful. You need to continue to configure the Wi-Fi module to activate.</span>
    <span class="token comment">// 3. The user enters the password and then reconnects, and then resends the ssid, pwd, token,</span>
    <span class="token comment">// &#xFF01;&#xFF01;&#xFF01;&#xFF01;Note that this operation must be done, otherwise it will affect the writing of Wi-Fi information and cause the distribution network to fail.</span>
    <span class="token punctuation">[</span>TYBLEMeshManager sharedInstance<span class="token punctuation">]</span><span class="token punctuation">.</span>wifiMac <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>mac<span class="token punctuation">;</span>

    <span class="token comment">// 4. get token</span>
    NSString <span class="token operator">*</span>nodeId <span class="token operator">=</span> <span class="token punctuation">[</span>NSString stringWithFormat<span class="token punctuation">:</span><span class="token string">@&quot;%02x&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>address<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token punctuation">[</span>TuyaSmartActivator sharedInstance<span class="token punctuation">]</span> getTokenWithMeshId<span class="token punctuation">:</span><span class="token punctuation">[</span>TuyaSmartUser sharedInstance<span class="token punctuation">]</span><span class="token punctuation">.</span>meshModel<span class="token punctuation">.</span>meshId
                                                 nodeId<span class="token punctuation">:</span>nodeId
                                              productId<span class="token punctuation">:</span><span class="token punctuation">[</span>TYBLEMeshManager sharedInstance<span class="token punctuation">]</span><span class="token punctuation">.</span>productId
                                                   uuid<span class="token punctuation">:</span><span class="token punctuation">[</span>TYBLEMeshManager sharedInstance<span class="token punctuation">]</span><span class="token punctuation">.</span>uuid
                                                authKey<span class="token punctuation">:</span><span class="token punctuation">[</span>TYBLEMeshManager sharedInstance<span class="token punctuation">]</span><span class="token punctuation">.</span>authKey
                                                version<span class="token punctuation">:</span><span class="token punctuation">[</span>TYBLEMeshManager sharedInstance<span class="token punctuation">]</span><span class="token punctuation">.</span>version
                                                success<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                                    <span class="token comment">// 5. Set up a network distribution agent and receive activation results through the agent</span>
                                                    <span class="token punctuation">[</span>TuyaSmartActivator sharedInstance<span class="token punctuation">]</span><span class="token punctuation">.</span>delegate <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">;</span>
                                                    <span class="token comment">// 6. start Wi-Fi config</span>
                                                    <span class="token punctuation">[</span><span class="token punctuation">[</span>TuyaSmartActivator sharedInstance<span class="token punctuation">]</span> startBleMeshConfigWiFiWithSsid<span class="token punctuation">:</span><span class="token string">@&quot;Wi-Fi ssid&quot;</span> password<span class="token punctuation">:</span><span class="token string">@&quot;Wi-Fi password&quot;</span> token<span class="token punctuation">:</span>token timeout<span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                                                <span class="token punctuation">}</span> failure<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>NSError <span class="token operator">*</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                                    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;error: %@&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                                <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>meshActivator<span class="token punctuation">:</span><span class="token punctuation">(</span>TuyaSmartActivator <span class="token operator">*</span><span class="token punctuation">)</span>activator didReceiveDeviceId<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>deviceId meshId<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>meshId error<span class="token punctuation">:</span><span class="token punctuation">(</span>NSError <span class="token operator">*</span><span class="token punctuation">)</span>error <span class="token punctuation">{</span>
      <span class="token comment">// 7. Receive activation result</span>

  <span class="token punctuation">}</span>
</code></pre>
</li>
</ul>
<h4 id="loign"><a name="loign" class="plugin-anchor" href="#loign"><i class="fa fa-link" aria-hidden="true"></i></a>Loign</h4>
<p>Network access is the operation of connecting to the mesh network through a networked device. This process requires Bluetooth to be turned on.</p>
<pre class="language-"><code class="lang-objective-c"><span class="token comment">/**
 mesh start

 If the operation is distribution network, fill in the default mesh name and password. At this time, it will only pass the `TYBLEMeshManagerDelegate`
 `- (void)bleMeshManager:(TYBLEMeshManager *)manager didScanedDevice:(TYBleMeshDeviceModel *)device;` 

 If the operation is to enter the network, fill in the created mesh name and password. This information is returned from the cloud interface. It can automatically connect, enter the network, and automatically obtain the online status of each device in the mesh network.

 @param name mesh 
 @param pwd mesh 
 @param active is active
 @param wifiAddress Wi-Fi address, required for gateway network configuration, the rest is 0
 @param otaAddress ota device address, required for ota upgrade, the rest is 0
 */</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>startScanWithName<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>name
                      pwd<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>pwd
                   active<span class="token punctuation">:</span><span class="token punctuation">(</span>BOOL<span class="token punctuation">)</span>active
              wifiAddress<span class="token punctuation">:</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>wifiAddress
               otaAddress<span class="token punctuation">:</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>otaAddress<span class="token punctuation">;</span>
</code></pre>
<p>Successful network access will automatically obtain the online status of the devices in the mesh network and trigger the <code>TuyaSmartHomeDelegate</code> delegate method to call back information</p>
<pre class="language-"><code>- (void)home:(TuyaSmartHome *)home deviceInfoUpdate:(TuyaSmartDeviceModel *)device;
</code></pre><p>&#x300C;Example&#x300D;</p>
<pre class="language-"><code class="lang-objective-c">
<span class="token punctuation">[</span><span class="token punctuation">[</span>TYBLEMeshManager sharedInstance<span class="token punctuation">]</span> startScanWithName<span class="token punctuation">:</span><span class="token punctuation">[</span>TuyaSmartUser sharedInstance<span class="token punctuation">]</span><span class="token punctuation">.</span>meshModel<span class="token punctuation">.</span>code pwd<span class="token punctuation">:</span><span class="token punctuation">[</span>TuyaSmartUser sharedInstance<span class="token punctuation">]</span><span class="token punctuation">.</span>meshModel<span class="token punctuation">.</span>password active<span class="token punctuation">:</span>NO wifiAddress<span class="token punctuation">:</span><span class="token number">0</span> otaAddress<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>home<span class="token punctuation">:</span><span class="token punctuation">(</span>TuyaSmartHome <span class="token operator">*</span><span class="token punctuation">)</span>home deviceInfoUpdate<span class="token punctuation">:</span><span class="token punctuation">(</span>TuyaSmartDeviceModel <span class="token operator">*</span><span class="token punctuation">)</span>device <span class="token punctuation">{</span>
    <span class="token comment">// callback</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="mesh-connection-flag"><a name="mesh-connection-flag" class="plugin-anchor" href="#mesh-connection-flag"><i class="fa fa-link" aria-hidden="true"></i></a>mesh connection flag</h4>
<p>In the process of operation, it is often judged whether the existing equipment of the mesh is connected to the network through Bluetooth to determine the method of issuing control commands and operation commands.</p>
<pre class="language-"><code class="lang-objective-c">BOOL isLogin <span class="token operator">=</span> <span class="token punctuation">[</span>TYBLEMeshManager sharedInstance<span class="token punctuation">]</span><span class="token punctuation">.</span>isLogin<span class="token punctuation">;</span>
</code></pre>
<h3 id="mesh-device"><a name="mesh-device" class="plugin-anchor" href="#mesh-device"><i class="fa fa-link" aria-hidden="true"></i></a>Mesh Device</h3>
<blockquote>
<p>Like the Home SDK, the device class is TuyaSmartDevice. The deviceType information in TuyaSmartDeviceModel inside can distinguish the device type.</p>
<p>Here the mesh device corresponds to the deviceType type TuyaSmartDeviceModelTypeMeshBleSubDev</p>
</blockquote>
<h4 id="get-device-instance"><a name="get-device-instance" class="plugin-anchor" href="#get-device-instance"><i class="fa fa-link" aria-hidden="true"></i></a>Get device instance</h4>
<pre class="language-"><code class="lang-objective-c"><span class="token operator">+</span> <span class="token punctuation">(</span>instancetype<span class="token punctuation">)</span>deviceWithDeviceId<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>devId<span class="token punctuation">;</span>
</code></pre>
<h4 id="rename-device"><a name="rename-device" class="plugin-anchor" href="#rename-device"><i class="fa fa-link" aria-hidden="true"></i></a>Rename Device</h4>
<pre class="language-"><code class="lang-objective-c"><span class="token comment">/**
 Rename mesh device

 @param deviceId    dev id
 @param name        new name
 @param success     
 @param failure     
 */</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>renameMeshSubDeviceWithDeviceId<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>deviceId name<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>name success<span class="token punctuation">:</span><span class="token punctuation">(</span>TYSuccessHandler<span class="token punctuation">)</span>success failure<span class="token punctuation">:</span><span class="token punctuation">(</span>TYFailureError<span class="token punctuation">)</span>failure<span class="token punctuation">;</span>
</code></pre>
<p>&#x300C;Example&#x300D;</p>
<pre class="language-"><code class="lang-objective-c"><span class="token punctuation">[</span><span class="token punctuation">[</span>TuyaSmartUser sharedInstance<span class="token punctuation">]</span><span class="token punctuation">.</span>mesh renameMeshSubDeviceWithDeviceId<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span>devId name<span class="token punctuation">:</span>name success<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">{</span>
            <span class="token comment">// success do</span>
        <span class="token punctuation">}</span> failure<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>NSError <span class="token operator">*</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// failure do</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre>
<h4 id="local-connection-and-gateway-connection"><a name="local-connection-and-gateway-connection" class="plugin-anchor" href="#local-connection-and-gateway-connection"><i class="fa fa-link" aria-hidden="true"></i></a>Local connection and gateway connection</h4>
<ul>
<li><p>Local connection</p>
<p>The Bluetooth of the mobile phone is turned on and the mesh device is controlled by Bluetooth.</p>
<p> <code>deviceModel.isOnline &amp;&amp; deviceModel.isMeshBleOnline</code></p>
</li>
<li><p>Gateway connection</p>
<p>The mobile phone&apos;s Bluetooth is not turned on or is far away from the device. The mesh device controls the connection through the gateway and issues commands by Wi-Fi.</p>
<p> <code>deviceModel.isOnline &amp;&amp; !deviceModel.isMeshBleOnline</code></p>
</li>
</ul>
<h4 id="remove-device"><a name="remove-device" class="plugin-anchor" href="#remove-device"><i class="fa fa-link" aria-hidden="true"></i></a>Remove Device</h4>
<p>Remove device requires cloud delete, local delete</p>
<h5 id="local-remove"><a name="local-remove" class="plugin-anchor" href="#local-remove"><i class="fa fa-link" aria-hidden="true"></i></a>Local remove</h5>
<p>   use ble</p>
<pre class="language-"><code class="lang-objective-c"><span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>kickoutLightWithAddress<span class="token punctuation">:</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>address type<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>type<span class="token punctuation">;</span>
</code></pre>
<p>   use gateway</p>
<pre class="language-"><code class="lang-objective-c"><span class="token operator">-</span> <span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>rawDataKickoutLightWithAddress<span class="token punctuation">:</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>address type<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>type<span class="token punctuation">;</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>publishRawDataWithRaw<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>raw
                          pcc<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>pcc
                      success<span class="token punctuation">:</span><span class="token punctuation">(</span>TYSuccessHandler<span class="token punctuation">)</span>success
                      failure<span class="token punctuation">:</span><span class="token punctuation">(</span>TYFailureError<span class="token punctuation">)</span>failure<span class="token punctuation">;</span>
</code></pre>
<ol>
<li><p>remote remove</p>
<pre class="language-"><code class="lang-objective-c"><span class="token comment">/**
 remove mesh sub node device

 @param deviceId   
 @param success   
 @param failure   
 */</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>removeMeshSubDeviceWithDeviceId<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>deviceId success<span class="token punctuation">:</span><span class="token punctuation">(</span>TYSuccessHandler<span class="token punctuation">)</span>success failure<span class="token punctuation">:</span><span class="token punctuation">(</span>TYFailureError<span class="token punctuation">)</span>failure<span class="token punctuation">;</span>
</code></pre>
<p>[Example]</p>
<pre class="language-"><code class="lang-objective-c"> <span class="token keyword">int</span> address <span class="token operator">=</span> <span class="token punctuation">[</span>smartDevice<span class="token punctuation">.</span>deviceModel<span class="token punctuation">.</span>nodeId intValue<span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span>

        <span class="token comment">// 1.  remote remove</span>
        <span class="token punctuation">[</span><span class="token punctuation">[</span>TuyaSmartUser sharedInstance<span class="token punctuation">]</span><span class="token punctuation">.</span>mesh removeMeshSubDeviceWithDeviceId<span class="token punctuation">:</span><span class="token punctuation">[</span>smartDevice<span class="token punctuation">.</span>deviceModel<span class="token punctuation">.</span>devId success<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">{</span>

        <span class="token punctuation">}</span> failure<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>NSError <span class="token operator">*</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token comment">// 2. local remove</span>
        <span class="token comment">// Judge the connection, use gateway or Bluetooth</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>TYBLEMeshManager sharedInstance<span class="token punctuation">]</span><span class="token punctuation">.</span>isLogin<span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token punctuation">[</span><span class="token punctuation">[</span>TYBLEMeshManager sharedInstance<span class="token punctuation">]</span> kickoutLightWithAddress<span class="token punctuation">:</span>address type<span class="token punctuation">:</span><span class="token punctuation">[</span>smartDevice<span class="token punctuation">.</span>deviceModel<span class="token punctuation">.</span>pcc<span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>

            <span class="token punctuation">[</span><span class="token punctuation">[</span>TuyaSmartUser sharedInstance<span class="token punctuation">]</span><span class="token punctuation">.</span>mesh publishRawDataWithRaw<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">[</span>TYBLEMeshManager sharedInstance<span class="token punctuation">]</span> rawDataKickoutLightWithAddress<span class="token punctuation">:</span>address type<span class="token punctuation">:</span><span class="token punctuation">[</span>smartDevice<span class="token punctuation">.</span>deviceModel<span class="token punctuation">.</span>pcc<span class="token punctuation">]</span> pcc<span class="token punctuation">:</span><span class="token punctuation">[</span>smartDevice<span class="token punctuation">.</span>deviceModel<span class="token punctuation">.</span>pcc success<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">{</span>

            <span class="token punctuation">}</span> failure<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>NSError <span class="token operator">*</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre>
</li>
</ol>
<h3 id="mesh-group"><a name="mesh-group" class="plugin-anchor" href="#mesh-group"><i class="fa fa-link" aria-hidden="true"></i></a>Mesh Group</h3>
<p>A group is one of the features of a mesh. After adding devices to the group, you can control all the devices in the group with one command.</p>
<p> <code>TuyaSmartBleMeshGroup</code></p>
<h4 id="create-group"><a name="create-group" class="plugin-anchor" href="#create-group"><i class="fa fa-link" aria-hidden="true"></i></a>Create Group</h4>
<blockquote>
<p>When creating the group address, the local Id starts from 0x8001, and is superimposed in order.</p>
<p>The size of the group is the same as that of the device. Incoming means that this group agrees that such devices are organized into a group.</p>
<p>Note: If other categories are forcibly added, control may fail due to different dp</p>
</blockquote>
<p>Currently, each mesh supports a maximum of 255 groups, and a device can only join a maximum of 8 groups.</p>
<pre class="language-"><code class="lang-objective-c"><span class="token comment">/**
 Create mesh group

 @param groupName mesh name
 @param meshId    meshId
 @param localId   group address 
 @param pcc 
 @param success 
 @param failure
 */</span>
<span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>createMeshGroupWithGroupName<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>groupName
                              meshId<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>meshId
                             localId<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>localId
                                 pcc<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>pcc
                             success<span class="token punctuation">:</span><span class="token punctuation">(</span>TYSuccessInt<span class="token punctuation">)</span>success
                             failure<span class="token punctuation">:</span><span class="token punctuation">(</span>TYFailureError<span class="token punctuation">)</span>failure<span class="token punctuation">;</span>
</code></pre>
<p>&#x300C;Example&#x300D;</p>
<pre class="language-"><code class="lang-objective-c">
NSInteger localId <span class="token operator">=</span> <span class="token number">0x8001</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span>TuyaSmartBleMeshGroup createMeshGroupWithGroupName<span class="token punctuation">:</span><span class="token operator">@</span><span class="token operator">&lt;</span>group name<span class="token operator">&gt;</span> meshId<span class="token punctuation">:</span><span class="token punctuation">[</span>TuyaSmartUser sharedInstance<span class="token punctuation">]</span><span class="token punctuation">.</span>meshModel<span class="token punctuation">.</span>meshId localId<span class="token punctuation">:</span><span class="token punctuation">[</span>NSString stringWithFormat<span class="token punctuation">:</span><span class="token string">@&quot;%lx&quot;</span><span class="token punctuation">,</span> localId<span class="token punctuation">]</span> pcc<span class="token punctuation">:</span>#<span class="token operator">&lt;</span>pcc<span class="token operator">&gt;</span> success<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span><span class="token keyword">int</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token comment">// success do</span>
     <span class="token keyword">self</span><span class="token punctuation">.</span>meshGroup <span class="token operator">=</span> <span class="token punctuation">[</span>TuyaSmartBleMeshGroup meshGroupWithGroupId<span class="token punctuation">:</span>result<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span> failure<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>NSError <span class="token operator">*</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token comment">// failure do</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre>
<h4 id="get-group-instance"><a name="get-group-instance" class="plugin-anchor" href="#get-group-instance"><i class="fa fa-link" aria-hidden="true"></i></a>Get Group Instance</h4>
<pre class="language-"><code class="lang-objective-c"><span class="token operator">+</span> <span class="token punctuation">(</span>instancetype<span class="token punctuation">)</span>meshGroupWithGroupId<span class="token punctuation">:</span><span class="token punctuation">(</span>NSInteger<span class="token punctuation">)</span>groupId<span class="token punctuation">;</span>
</code></pre>
<blockquote>
<p>Note: The <code>groupId</code> here is not the <code>localId</code> described above. This is the field given by the server after the group is successfully added.</p>
<p>All addresses issued by group operations are only related to <code>localId</code></p>
</blockquote>
<h4 id="update-group-name"><a name="update-group-name" class="plugin-anchor" href="#update-group-name"><i class="fa fa-link" aria-hidden="true"></i></a>Update Group name</h4>
<pre class="language-"><code class="lang-objective-c"><span class="token comment">/**
 Update Group name

 @param meshGroupName new name
 @param success 
 @param failure 
 */</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>updateMeshGroupName<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>meshGroupName success<span class="token punctuation">:</span><span class="token punctuation">(</span>TYSuccessHandler<span class="token punctuation">)</span>success failure<span class="token punctuation">:</span><span class="token punctuation">(</span>TYFailureError<span class="token punctuation">)</span>failure<span class="token punctuation">;</span>
</code></pre>
<h4 id="remove-device-from-group"><a name="remove-device-from-group" class="plugin-anchor" href="#remove-device-from-group"><i class="fa fa-link" aria-hidden="true"></i></a>Remove device from group</h4>
<ul>
<li><p>Local Bluetooth</p>
<pre class="language-"><code class="lang-objective-c"><span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>deleteGroupAddress<span class="token punctuation">:</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>groupAddress type<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>type<span class="token punctuation">;</span>
</code></pre>
</li>
</ul>
<ul>
<li><p>Gateway</p>
<pre class="language-"><code class="lang-objective-c"><span class="token operator">-</span> <span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>rawDataDeleteGroupAddress<span class="token punctuation">:</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>groupAddress type<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>type

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>publishRawDataWithRaw<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>raw
       pcc<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>pcc
                      success<span class="token punctuation">:</span><span class="token punctuation">(</span>TYSuccessHandler<span class="token punctuation">)</span>success
                      failure<span class="token punctuation">:</span><span class="token punctuation">(</span>TYFailureError<span class="token punctuation">)</span>failure<span class="token punctuation">;</span>
</code></pre>
</li>
</ul>
<p>Remote delete:</p>
<pre class="language-"><code class="lang-objective-c"><span class="token comment">/**
 delete group 

 @param success 
 @param failure 
 */</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>removeMeshGroupWithSuccess<span class="token punctuation">:</span><span class="token punctuation">(</span>TYSuccessHandler<span class="token punctuation">)</span>success failure<span class="token punctuation">:</span><span class="token punctuation">(</span>TYFailureError<span class="token punctuation">)</span>failure<span class="token punctuation">;</span>
</code></pre>
<p>&#x300C;Example&#x300D;</p>
<pre class="language-"><code class="lang-objective-c">
    <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>meshGroup removeMeshGroupWithSuccess<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">{</span>
           <span class="token comment">//</span>
    <span class="token punctuation">}</span> failure<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>NSError <span class="token operator">*</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// </span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// if local connection</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>TYBLEMeshManager sharedInstance<span class="token punctuation">]</span><span class="token punctuation">.</span>isLogin<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// use ble </span>
        <span class="token punctuation">[</span><span class="token punctuation">[</span>TYBLEMeshManager sharedInstance<span class="token punctuation">]</span> deleteGroupAddress<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>meshGroup<span class="token punctuation">.</span>meshGroupModel<span class="token punctuation">.</span>localId intValue<span class="token punctuation">]</span> type<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>meshGroup<span class="token punctuation">.</span>meshGroupModel<span class="token punctuation">.</span>pcc<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// wifi</span>
        <span class="token comment">// use gateway</span>
        <span class="token punctuation">[</span><span class="token punctuation">[</span>TuyaSmartUser sharedInstance<span class="token punctuation">]</span><span class="token punctuation">.</span>mesh publishRawDataWithRaw<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">[</span>TYBLEMeshManager sharedInstance<span class="token punctuation">]</span> rawDataDeleteGroupAddress<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>meshGroup<span class="token punctuation">.</span>meshGroupModel<span class="token punctuation">.</span>localId intValue<span class="token punctuation">]</span> type<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>meshGroup<span class="token punctuation">.</span>meshGroupModel<span class="token punctuation">.</span>pcc<span class="token punctuation">]</span> pcc<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>meshGroup<span class="token punctuation">.</span>meshGroupModel<span class="token punctuation">.</span>pcc success<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">{</span>
        <span class="token punctuation">}</span> failure<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>NSError <span class="token operator">*</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
<h4 id="add-device-to-group"><a name="add-device-to-group" class="plugin-anchor" href="#add-device-to-group"><i class="fa fa-link" aria-hidden="true"></i></a>Add device to group</h4>
<blockquote>
<p>Adding a device to a group requires local and cloud double verification before it can be counted as a device successfully joining the group. Results</p>
<p>Operations are performed one by one by the device and performed sequentially. Not concurrent</p>
</blockquote>
<p>Local add</p>
<ul>
<li><p>Local connection</p>
<pre class="language-"><code class="lang-objective-c"><span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>addDeviceAddress<span class="token punctuation">:</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>deviceAddress type<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>type groupAddress<span class="token punctuation">:</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>groupAddress<span class="token punctuation">;</span>

<span class="token comment">// TYBLEMeshManagerDelegate</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>deviceAddGroupAddress<span class="token punctuation">:</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>address error<span class="token punctuation">:</span><span class="token punctuation">(</span>NSError <span class="token operator">*</span><span class="token punctuation">)</span>error<span class="token punctuation">;</span>
</code></pre>
</li>
<li><p>Gateway connection</p>
<pre class="language-"><code class="lang-objective-c">
<span class="token operator">-</span> <span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>rawDataAddDeviceAddress<span class="token punctuation">:</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>deviceAddress groupAddress<span class="token punctuation">:</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>groupAddress type<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>type<span class="token punctuation">;</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>publishRawDataWithRaw<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>raw
                          pcc<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>pcc
                      success<span class="token punctuation">:</span><span class="token punctuation">(</span>TYSuccessHandler<span class="token punctuation">)</span>success
                      failure<span class="token punctuation">:</span><span class="token punctuation">(</span>TYFailureError<span class="token punctuation">)</span>failure<span class="token punctuation">;</span>

<span class="token comment">// TuyaSmartBleMeshDelegate </span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>bleMeshReceiveRawData<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>raw<span class="token punctuation">;</span>
</code></pre>
</li>
</ul>
<p>Remote add</p>
<p>After the above verification is completed, you can use this method to record the operation to the cloud and then proceed to the next device operation</p>
<pre class="language-"><code class="lang-objective-c"><span class="token comment">/**
  Add device to group

 @param success 
 @param failure 
 */</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>addDeviceWithDeviceId<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>deviceId success<span class="token punctuation">:</span><span class="token punctuation">(</span>TYSuccessHandler<span class="token punctuation">)</span>success failure<span class="token punctuation">:</span><span class="token punctuation">(</span>TYFailureError<span class="token punctuation">)</span>failure<span class="token punctuation">;</span>
</code></pre>
<p>&#x300C;Example&#x300D;</p>
<pre class="language-"><code class="lang-objective-c"><span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>addDeviceToGroup<span class="token punctuation">:</span><span class="token punctuation">(</span>TuyaSmartDeviceModel <span class="token operator">*</span><span class="token punctuation">)</span>model <span class="token punctuation">{</span>
        <span class="token keyword">int</span> nodeId <span class="token operator">=</span> <span class="token punctuation">[</span>model<span class="token punctuation">.</span>nodeId intValue<span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span>
        <span class="token comment">// ...</span>
        _address <span class="token operator">=</span> nodeId <span class="token operator">&gt;&gt;</span> <span class="token number">8</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>TYBLEMeshManager sharedInstance<span class="token punctuation">]</span><span class="token punctuation">.</span>isLogin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// ble</span>
            <span class="token punctuation">[</span><span class="token punctuation">[</span>TYBLEMeshManager sharedInstance<span class="token punctuation">]</span> addDeviceAddress<span class="token punctuation">:</span>nodeId type<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>meshGroup<span class="token punctuation">.</span>meshGroupModel<span class="token punctuation">.</span>pcc groupAddress<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>meshGroup<span class="token punctuation">.</span>meshGroupModel<span class="token punctuation">.</span>localId intValue<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// wifi</span>
            <span class="token punctuation">[</span><span class="token punctuation">[</span>TuyaSmartUser sharedInstance<span class="token punctuation">]</span><span class="token punctuation">.</span>mesh publishRawDataWithRaw<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">[</span>TYBLEMeshManager sharedInstance<span class="token punctuation">]</span> rawDataAddDeviceAddress<span class="token punctuation">:</span>nodeId groupAddress<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>meshGroup<span class="token punctuation">.</span>meshGroupModel<span class="token punctuation">.</span>localId intValue<span class="token punctuation">]</span> type<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>meshGroup<span class="token punctuation">.</span>meshGroupModel<span class="token punctuation">.</span>pcc<span class="token punctuation">]</span> pcc<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>meshGroup<span class="token punctuation">.</span>meshGroupModel<span class="token punctuation">.</span>pcc success<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">{</span>
            <span class="token punctuation">}</span> failure<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>NSError <span class="token operator">*</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// add flag</span>
        _isAdd <span class="token operator">=</span> YES<span class="token punctuation">;</span>

    <span class="token comment">// Here you can do the timeout yourself. It is recommended to fail if it is not received within 5s, and execute the next one.</span>
<span class="token punctuation">}</span>


<span class="token macro property">#<span class="token directive keyword">pragma</span> mark - TYBLEMeshManagerDelegate</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>deviceAddGroupAddress<span class="token punctuation">:</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>address<span class="token punctuation">;</span> <span class="token punctuation">{</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot; --- deviceAddGroupAddress %d &quot;</span><span class="token punctuation">,</span> address<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>_address <span class="token operator">==</span> address<span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>meshGroup addDeviceWithDeviceId<span class="token punctuation">:</span>_devId success<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">{</span>
                <span class="token comment">// success, next</span>
            <span class="token punctuation">}</span> failure<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>NSError <span class="token operator">*</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token macro property">#<span class="token directive keyword">pragma</span> mark - TuyaSmartBleMeshDelegate</span>

<span class="token comment">// This method will be triggered under the gateway connection </span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>bleMeshReceiveRawData<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>raw <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span>raw substringWithRange<span class="token punctuation">:</span><span class="token function">NSMakeRange</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span> isEqualToString<span class="token punctuation">:</span><span class="token string">@&quot;d4&quot;</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> _address <span class="token operator">==</span> <span class="token punctuation">[</span>TPUtils getIntValueByHex<span class="token punctuation">:</span><span class="token punctuation">[</span>raw substringWithRange<span class="token punctuation">:</span><span class="token function">NSMakeRange</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>raw<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">14</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;raw error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        BOOL isNewProtocol <span class="token operator">=</span> <span class="token punctuation">[</span>TPUtils getIntValueByHex<span class="token punctuation">:</span><span class="token punctuation">[</span>raw substringWithRange<span class="token punctuation">:</span><span class="token function">NSMakeRange</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">255</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>isNewProtocol<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> state <span class="token operator">=</span> <span class="token punctuation">[</span>TPUtils getIntValueByHex<span class="token punctuation">:</span><span class="token punctuation">[</span>raw substringWithRange<span class="token punctuation">:</span><span class="token function">NSMakeRange</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">||</span> state <span class="token operator">==</span> <span class="token number">255</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                   <span class="token comment">// next</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>

            <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>meshGroup addDeviceWithDeviceId<span class="token punctuation">:</span>_devId success<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">{</span>
                <span class="token comment">// next</span>
            <span class="token punctuation">}</span> failure<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>NSError <span class="token operator">*</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="remove-device-from-group"><a name="remove-device-from-group" class="plugin-anchor" href="#remove-device-from-group"><i class="fa fa-link" aria-hidden="true"></i></a>Remove device from group</h4>
<ul>
<li><p>Local Bluetooth</p>
<pre class="language-"><code class="lang-objective-c">
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>deleteDeviceAddress<span class="token punctuation">:</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>deviceAddress type<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>type groupAddress<span class="token punctuation">:</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>groupAddress<span class="token punctuation">;</span>

<span class="token comment">// TYBLEMeshManagerDelegate callback</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>deviceAddGroupAddress<span class="token punctuation">:</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>address error<span class="token punctuation">:</span><span class="token punctuation">(</span>NSError <span class="token operator">*</span><span class="token punctuation">)</span>error<span class="token punctuation">;</span>
</code></pre>
</li>
<li><p>Gateway</p>
<pre class="language-"><code class="lang-objective-c">
<span class="token operator">-</span> <span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>rawDataDeleteDeviceAddress<span class="token punctuation">:</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>deviceAddress groupAddress<span class="token punctuation">:</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>groupAddress type<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>type

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>publishRawDataWithRaw<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>raw
                          pcc<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>pcc
                      success<span class="token punctuation">:</span><span class="token punctuation">(</span>TYSuccessHandler<span class="token punctuation">)</span>success
                      failure<span class="token punctuation">:</span><span class="token punctuation">(</span>TYFailureError<span class="token punctuation">)</span>failure<span class="token punctuation">;</span>

<span class="token comment">// `TuyaSmartBleMeshDelegate` - (void)bleMeshReceiveRawData:(NSString *)raw callback</span>
<span class="token comment">// TuyaSmartBleMeshDelegate </span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>bleMeshReceiveRawData<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>raw<span class="token punctuation">;</span>
</code></pre>
</li>
</ul>
<p>Remote delete</p>
<p>After the above verification is completed, you can use this method to record the operation to the cloud and then proceed to the next device operation</p>
<pre class="language-"><code class="lang-objective-c">
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>removeDeviceWithDeviceId<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>deviceId success<span class="token punctuation">:</span><span class="token punctuation">(</span>TYSuccessHandler<span class="token punctuation">)</span>success failure<span class="token punctuation">:</span><span class="token punctuation">(</span>TYFailureError<span class="token punctuation">)</span>failure<span class="token punctuation">;</span>
</code></pre>
<p>&#x300C;Example&#x300D;</p>
<pre class="language-"><code class="lang-objective-c"><span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>deleteDeviceFromGroup<span class="token punctuation">:</span><span class="token punctuation">(</span>TuyaSmartDeviceModel <span class="token operator">*</span><span class="token punctuation">)</span>model <span class="token punctuation">{</span>

        <span class="token keyword">int</span> nodeId <span class="token operator">=</span> <span class="token punctuation">[</span>model<span class="token punctuation">.</span>nodeId intValue<span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span>

        <span class="token comment">// Record the device address of the current operation for subsequent callback judgment</span>
        _address <span class="token operator">=</span> nodeId <span class="token operator">&gt;&gt;</span> <span class="token number">8</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>TYBLEMeshManager sharedInstance<span class="token punctuation">]</span><span class="token punctuation">.</span>isLogin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// ble</span>
            <span class="token punctuation">[</span><span class="token punctuation">[</span>TYBLEMeshManager sharedInstance<span class="token punctuation">]</span> deleteDeviceAddress<span class="token punctuation">:</span>nodeId type<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>meshGroup<span class="token punctuation">.</span>meshGroupModel<span class="token punctuation">.</span>pcc groupAddress<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>meshGroup<span class="token punctuation">.</span>meshGroupModel<span class="token punctuation">.</span>localId intValue<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// wifi</span>
            <span class="token punctuation">[</span><span class="token punctuation">[</span>TuyaSmartUser sharedInstance<span class="token punctuation">]</span><span class="token punctuation">.</span>mesh publishRawDataWithRaw<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">[</span>TYBLEMeshManager sharedInstance<span class="token punctuation">]</span> rawDataDeleteDeviceAddress<span class="token punctuation">:</span>nodeId groupAddress<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>meshGroup<span class="token punctuation">.</span>meshGroupModel<span class="token punctuation">.</span>localId intValue<span class="token punctuation">]</span> type<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>meshGroup<span class="token punctuation">.</span>meshGroupModel<span class="token punctuation">.</span>pcc<span class="token punctuation">]</span> pcc<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>meshGroup<span class="token punctuation">.</span>meshGroupModel<span class="token punctuation">.</span>pcc success<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">{</span>
            <span class="token punctuation">}</span> failure<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>NSError <span class="token operator">*</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// delete flag</span>
        _isAdd <span class="token operator">=</span> NO<span class="token punctuation">;</span>

  <span class="token comment">//Here you can do the timeout yourself. It is recommended to fail if it is not received within 5s, and execute the next one.</span>
<span class="token punctuation">}</span>


<span class="token macro property">#<span class="token directive keyword">pragma</span> mark - TYBLEMeshManagerDelegate</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>deviceAddGroupAddress<span class="token punctuation">:</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>address<span class="token punctuation">;</span> <span class="token punctuation">{</span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot; --- deviceAddGroupAddress %d &quot;</span><span class="token punctuation">,</span> address<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>_address <span class="token operator">==</span> address<span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>meshGroup removeDeviceWithDeviceId<span class="token punctuation">:</span>_devId success<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">{</span>
                <span class="token comment">//  success next</span>
            <span class="token punctuation">}</span> failure<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>NSError <span class="token operator">*</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token macro property">#<span class="token directive keyword">pragma</span> mark - TuyaSmartBleMeshDelegate</span>

<span class="token comment">// This method will be triggered under the gateway connection </span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>bleMeshReceiveRawData<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>raw <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span>raw substringWithRange<span class="token punctuation">:</span><span class="token function">NSMakeRange</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span> isEqualToString<span class="token punctuation">:</span><span class="token string">@&quot;d4&quot;</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> _address <span class="token operator">==</span> <span class="token punctuation">[</span>TPUtils getIntValueByHex<span class="token punctuation">:</span><span class="token punctuation">[</span>raw substringWithRange<span class="token punctuation">:</span><span class="token function">NSMakeRange</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>raw<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">14</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;raw error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        BOOL isNewProtocol <span class="token operator">=</span> <span class="token punctuation">[</span>TPUtils getIntValueByHex<span class="token punctuation">:</span><span class="token punctuation">[</span>raw substringWithRange<span class="token punctuation">:</span><span class="token function">NSMakeRange</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">255</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>isNewProtocol<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> state <span class="token operator">=</span> <span class="token punctuation">[</span>TPUtils getIntValueByHex<span class="token punctuation">:</span><span class="token punctuation">[</span>raw substringWithRange<span class="token punctuation">:</span><span class="token function">NSMakeRange</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">||</span> state <span class="token operator">==</span> <span class="token number">255</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                   <span class="token comment">// next</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>

            <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>meshGroup removeDeviceWithDeviceId<span class="token punctuation">:</span>_devId success<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">{</span>
                <span class="token comment">// success next </span>
            <span class="token punctuation">}</span> failure<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>NSError <span class="token operator">*</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="get-devices-in-a-group"><a name="get-devices-in-a-group" class="plugin-anchor" href="#get-devices-in-a-group"><i class="fa fa-link" aria-hidden="true"></i></a>Get devices in a group</h4>
<pre class="language-"><code class="lang-objective-c"><span class="token comment">/**
 Get device list information in a group

 @param success 
 @param failure 
 */</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>getDeviveListInfoWithSuccess<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">^</span><span class="token punctuation">)</span><span class="token punctuation">(</span>NSArray <span class="token operator">&lt;</span>TuyaSmartDeviceModel <span class="token operator">*</span><span class="token operator">&gt;</span> <span class="token operator">*</span>deviceList<span class="token punctuation">)</span><span class="token punctuation">)</span>success failure<span class="token punctuation">:</span><span class="token punctuation">(</span>TYFailureError<span class="token punctuation">)</span>failure<span class="token punctuation">;</span>
</code></pre>
<p>&#x300C;Example&#x300D;</p>
<pre class="language-"><code class="lang-objective-c"><span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>meshGroup getDeviveListInfoWithSuccess<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>NSArray<span class="token operator">&lt;</span>TuyaSmartDeviceModel <span class="token operator">*</span><span class="token operator">&gt;</span> <span class="token operator">*</span>deviceList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// success</span>
<span class="token punctuation">}</span> failure<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>NSError <span class="token operator">*</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// fail</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="mesh-control"><a name="mesh-control" class="plugin-anchor" href="#mesh-control"><i class="fa fa-link" aria-hidden="true"></i></a>Mesh Control</h3>
<h4 id="command"><a name="command" class="plugin-anchor" href="#command"><i class="fa fa-link" aria-hidden="true"></i></a>command</h4>
<p><code>{&quot;(dpId)&quot; : &quot;(dpValue)&quot;}</code>&#xFF0C;  <code>@{@&quot;101&quot; : @&quot;44&quot;}</code></p>
<h4 id="control-device"><a name="control-device" class="plugin-anchor" href="#control-device"><i class="fa fa-link" aria-hidden="true"></i></a>Control device</h4>
<pre class="language-"><code class="lang-objective-c"><span class="token comment">/**
 device dps publish

 @param nodeId device node
 @param pcc pcc
 @param dps dps
 @param success 
 @param failure 
 */</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>publishNodeId<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>nodeId
                  pcc<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>pcc
                  dps<span class="token punctuation">:</span><span class="token punctuation">(</span>NSDictionary <span class="token operator">*</span><span class="token punctuation">)</span>dps
              success<span class="token punctuation">:</span><span class="token punctuation">(</span>TYSuccessHandler<span class="token punctuation">)</span>success
              failure<span class="token punctuation">:</span><span class="token punctuation">(</span>TYFailureError<span class="token punctuation">)</span>failure<span class="token punctuation">;</span>
</code></pre>
<p>&#x300C;Example&#x300D;</p>
<pre class="language-"><code class="lang-objective-c"><span class="token keyword">int</span> address <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>smartDevice deviceModel<span class="token punctuation">]</span><span class="token punctuation">.</span>nodeId intValue<span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>mesh publishNodeId<span class="token punctuation">:</span><span class="token punctuation">[</span>NSString stringWithFormat<span class="token punctuation">:</span><span class="token string">@&quot;%d&quot;</span><span class="token punctuation">,</span> address<span class="token punctuation">]</span> pcc<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>smartDevice<span class="token punctuation">.</span>deviceModel<span class="token punctuation">.</span>pcc dps<span class="token punctuation">:</span><span class="token operator">@</span><span class="token punctuation">{</span><span class="token string">@&quot;1&quot;</span><span class="token punctuation">:</span><span class="token operator">@</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span> success<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">{</span>
    <span class="token comment">// success do </span>
    <span class="token punctuation">}</span> failure<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>NSError <span class="token operator">*</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// error do</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre>
<h4 id="control-group"><a name="control-group" class="plugin-anchor" href="#control-group"><i class="fa fa-link" aria-hidden="true"></i></a>Control group</h4>
<pre class="language-"><code class="lang-objective-c"><span class="token comment">/**
 group dps publish 

 @param localId    localId
 @param pcc     pcc
 @param dps      dps
 @param success 
 @param failure 
 */</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>multiPublishWithLocalId<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>localId
                            pcc<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>pcc
                            dps<span class="token punctuation">:</span><span class="token punctuation">(</span>NSDictionary <span class="token operator">*</span><span class="token punctuation">)</span>dps
                        success<span class="token punctuation">:</span><span class="token punctuation">(</span>TYSuccessHandler<span class="token punctuation">)</span>success
                        failure<span class="token punctuation">:</span><span class="token punctuation">(</span>TYFailureError<span class="token punctuation">)</span>failure<span class="token punctuation">;</span>
</code></pre>
<p>&#x300C;Example&#x300D;</p>
<pre class="language-"><code class="lang-objective-c"><span class="token keyword">int</span> address <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>meshGroup meshGroupModel<span class="token punctuation">]</span><span class="token punctuation">.</span>localId intValue<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>mesh multiPublishWithLocalId<span class="token punctuation">:</span><span class="token punctuation">[</span>NSString stringWithFormat<span class="token punctuation">:</span><span class="token string">@&quot;%d&quot;</span><span class="token punctuation">,</span> address<span class="token punctuation">]</span> pcc<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>meshGroup<span class="token punctuation">.</span>meshGroupModel<span class="token punctuation">.</span>pcc dps<span class="token punctuation">:</span><span class="token operator">@</span><span class="token punctuation">{</span><span class="token string">@&quot;1&quot;</span><span class="token punctuation">:</span><span class="token operator">@</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span> success<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">{</span>
    <span class="token comment">// success do </span>
    <span class="token punctuation">}</span> failure<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>NSError <span class="token operator">*</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// error do</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre>
<h4 id="gateway-raw-command"><a name="gateway-raw-command" class="plugin-anchor" href="#gateway-raw-command"><i class="fa fa-link" aria-hidden="true"></i></a>Gateway raw command</h4>
<blockquote>
<p>TYBLEMeshManager support raw command</p>
</blockquote>
<pre class="language-"><code class="lang-objective-c">
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>publishRawDataWithRaw<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>raw
                          pcc<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>pcc
                      success<span class="token punctuation">:</span><span class="token punctuation">(</span>TYSuccessHandler<span class="token punctuation">)</span>success
                      failure<span class="token punctuation">:</span><span class="token punctuation">(</span>TYFailureError<span class="token punctuation">)</span>failure<span class="token punctuation">;</span>
</code></pre>
<h4 id="device-info-update"><a name="device-info-update" class="plugin-anchor" href="#device-info-update"><i class="fa fa-link" aria-hidden="true"></i></a>Device info update</h4>
<p>After sending the command, if there is a returned command, the device&apos;s data reply is called back through the proxy in <code>TuyaSmartHomeDelegate</code></p>
<pre class="language-"><code>// dps update
- (void)home:(TuyaSmartHome *)home device:(TuyaSmartDeviceModel *)device dpsUpdate:(NSDictionary *)dps;
</code></pre><h3 id="firmware-upgrade"><a name="firmware-upgrade" class="plugin-anchor" href="#firmware-upgrade"><i class="fa fa-link" aria-hidden="true"></i></a>Firmware Upgrade</h3>
<h4 id="query-firmware-info"><a name="query-firmware-info" class="plugin-anchor" href="#query-firmware-info"><i class="fa fa-link" aria-hidden="true"></i></a>Query firmware info</h4>
<pre class="language-"><code class="lang-objective-c"><span class="token comment">/**
 *  get device upgrade info
 *
 *  @param success
 *  @param failure 
 */</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>getFirmwareUpgradeInfo<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">^</span><span class="token punctuation">)</span><span class="token punctuation">(</span>NSArray <span class="token operator">&lt;</span>TuyaSmartFirmwareUpgradeModel <span class="token operator">*</span><span class="token operator">&gt;</span> <span class="token operator">*</span>upgradeModelList<span class="token punctuation">)</span><span class="token punctuation">)</span>success failure<span class="token punctuation">:</span><span class="token punctuation">(</span>TYFailureError<span class="token punctuation">)</span>failure<span class="token punctuation">;</span>
</code></pre>
<pre class="language-"><code>/*
type 
     0  updrading
     1  no upgrade
     2  force or remind upgrade
     3  check upgrade
*/
</code></pre><h4 id="sub-device-upgrade"><a name="sub-device-upgrade" class="plugin-anchor" href="#sub-device-upgrade"><i class="fa fa-link" aria-hidden="true"></i></a>Sub-Device Upgrade</h4>
<p>Ensure device online</p>
<pre class="language-"><code class="lang-objective-c"><span class="token number">1.</span> connect target device
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>startScanWithName<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>name
                      pwd<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>pwd
                   active<span class="token punctuation">:</span><span class="token punctuation">(</span>BOOL<span class="token punctuation">)</span>active
              wifiAddress<span class="token punctuation">:</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>wifiAddress
               otaAddress<span class="token punctuation">:</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>otaAddress<span class="token punctuation">;</span>

<span class="token number">2.</span> After setting<span class="token punctuation">,</span> it will be connected<span class="token punctuation">.</span> You can receive the connection through the `TYBLEMeshManagerDelegate` proxy method<span class="token punctuation">.</span>
<span class="token comment">/**
 mesh login

 @param address node address
 */</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>notifyLoginSuccessWithAddress<span class="token punctuation">:</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>address<span class="token punctuation">;</span>


<span class="token number">3.</span> Send upgrade package after receiving callback
<span class="token comment">/**
 send pack

 @param address node address
 @param version 
 @param otaData 
 @param success 
 @param failure 
 */</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>sendOTAPackWithAddress<span class="token punctuation">:</span><span class="token punctuation">(</span>NSInteger<span class="token punctuation">)</span>address version<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>version otaData<span class="token punctuation">:</span><span class="token punctuation">(</span>NSData <span class="token operator">*</span><span class="token punctuation">)</span>otaData success<span class="token punctuation">:</span><span class="token punctuation">(</span>TYSuccessHandler<span class="token punctuation">)</span>success failure<span class="token punctuation">:</span><span class="token punctuation">(</span>TYFailureHandler<span class="token punctuation">)</span>failure<span class="token punctuation">;</span>

<span class="token number">4.</span> Update version number to the remote
<span class="token comment">/**
 *  update version
 *
 *  @param version 
 *  @param type    upgradeModel.type
 *  @param success 
 *  @param failure 
 */</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>updateDeviceVersion<span class="token punctuation">:</span><span class="token punctuation">(</span>NSString <span class="token operator">*</span><span class="token punctuation">)</span>version type<span class="token punctuation">:</span><span class="token punctuation">(</span>NSInteger<span class="token punctuation">)</span>type success<span class="token punctuation">:</span><span class="token punctuation">(</span>TYSuccessHandler<span class="token punctuation">)</span>success failure<span class="token punctuation">:</span><span class="token punctuation">(</span>TYFailureError<span class="token punctuation">)</span>failure<span class="token punctuation">;</span>
</code></pre>
<p>&#x300C;Example&#x300D;</p>
<pre class="language-"><code class="lang-objective-c"><span class="token number">1.</span> prepare
<span class="token keyword">int</span> otaAddress <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span>deviceModel<span class="token punctuation">.</span>nodeId intValue<span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span>
<span class="token comment">// ble connect</span>
    <span class="token punctuation">[</span><span class="token punctuation">[</span>TYBLEMeshManager sharedInstance<span class="token punctuation">]</span> startScanWithName<span class="token punctuation">:</span><span class="token punctuation">[</span>TuyaSmartUser sharedInstance<span class="token punctuation">]</span><span class="token punctuation">.</span>meshModel<span class="token punctuation">.</span>code pwd<span class="token punctuation">:</span><span class="token punctuation">[</span>TuyaSmartUser sharedInstance<span class="token punctuation">]</span><span class="token punctuation">.</span>meshModel<span class="token punctuation">.</span>password active<span class="token punctuation">:</span>NO wifiAddress<span class="token punctuation">:</span><span class="token number">0</span> otaAddress<span class="token punctuation">:</span>otaAddress<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span>TYBLEMeshManager sharedInstance<span class="token punctuation">]</span><span class="token punctuation">.</span>delegate <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">;</span>


<span class="token number">2.</span> <span class="token number">3.</span> callback and send pack
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>notifyLoginSuccessWithAddress<span class="token punctuation">:</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>address <span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token punctuation">[</span>TYBLEMeshManager sharedInstance<span class="token punctuation">]</span> sendOTAPackWithAddress<span class="token punctuation">:</span>address version<span class="token punctuation">:</span>#<span class="token operator">&lt;</span>version<span class="token operator">&gt;</span> otaData<span class="token punctuation">:</span>_otaData success<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token keyword">self</span> updateVersion<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> failure<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">{</span>
        <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@&quot;ota failure!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token number">4.</span> Update version
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>updateVersion <span class="token punctuation">{</span>
    WEAKSELF_AT
    <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>smartDevice updateDeviceVersion<span class="token punctuation">:</span>_upgradeModel<span class="token punctuation">.</span>version type<span class="token punctuation">:</span>_upgradeModel<span class="token punctuation">.</span>type success<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">{</span>
       <span class="token comment">// success do..</span>
    <span class="token punctuation">}</span> failure<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>NSError <span class="token operator">*</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token comment">// error do.. </span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="BLE.html#device-dp-publish" class="navigation navigation-prev " aria-label="Previous page: Device DP publish">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="Mesh.html#basic-notion" class="navigation navigation-next " aria-label="Next page: Basic Notion">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Bluetooth Mesh(TUYA)","level":"1.16","depth":1,"next":{"title":"Basic Notion","level":"1.16.1","depth":2,"anchor":"#basic-notion","path":"resource/Mesh.md","ref":"./resource/Mesh.md#basic-notion","articles":[]},"previous":{"title":"Device DP publish","level":"1.15.5","depth":2,"anchor":"#device-dp-publish","path":"resource/BLE.md","ref":"./resource/BLE.md#device-dp-publish","articles":[]},"dir":"ltr"},"config":{"plugins":["js-sequence-diagram-full@>=0.3.1","prism","-highlight","anchors"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"prism":{"css":["prismjs/themes/prism-okaidia.css"],"lang":{"oc":"objectivec","objc":"objectivec","objective-c":"objectivec"},"ignore":["sequence"]},"js-sequence-diagram-full":{},"anchors":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"language":"en","gitbook":"*"},"file":{"path":"resource/Mesh.md","mtime":"2020-02-10T09:09:37.195Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-02-10T09:10:22.112Z"},"basePath":"..","book":{"language":"en"}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-js-sequence-diagram-full/sequence-diagram-min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-js-sequence-diagram-full/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

